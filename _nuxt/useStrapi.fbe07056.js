import{C as P,y as h,K as _,L as g,M as D,x,u as O,q as w,N as C,O as E}from"./entry.0ef2c0e8.js";const B=()=>null;function k(...s){var v;const y=typeof s[s.length-1]=="string"?s.pop():void 0;typeof s[0]!="string"&&s.unshift(y);let[n,u,a={}]=s;if(typeof n!="string")throw new TypeError("[nuxt] [asyncData] key must be a string.");if(typeof u!="function")throw new TypeError("[nuxt] [asyncData] handler must be a function.");a.server=a.server??!0,a.default=a.default??B,a.lazy=a.lazy??!1,a.immediate=a.immediate??!0;const t=P(),p=()=>t.isHydrating?t.payload.data[n]:t.static.data[n],o=()=>p()!==void 0;t._asyncData[n]||(t._asyncData[n]={data:h(p()??((v=a.default)==null?void 0:v.call(a))??null),pending:h(!o()),error:h(t.payload._errors[n]?_(t.payload._errors[n]):null)});const e={...t._asyncData[n]};e.refresh=e.execute=(i={})=>{if(t._asyncDataPromises[n]){if(i.dedupe===!1)return t._asyncDataPromises[n];t._asyncDataPromises[n].cancelled=!0}if(i._initial&&o())return p();e.pending.value=!0;const f=new Promise((r,c)=>{try{r(u(t))}catch(b){c(b)}}).then(r=>{if(f.cancelled)return t._asyncDataPromises[n];let c=r;a.transform&&(c=a.transform(r)),a.pick&&(c=j(c,a.pick)),e.data.value=c,e.error.value=null}).catch(r=>{var c;if(f.cancelled)return t._asyncDataPromises[n];e.error.value=r,e.data.value=O(((c=a.default)==null?void 0:c.call(a))??null)}).finally(()=>{f.cancelled||(e.pending.value=!1,t.payload.data[n]=e.data.value,e.error.value&&(t.payload._errors[n]=_(e.error.value)),delete t._asyncDataPromises[n])});return t._asyncDataPromises[n]=f,t._asyncDataPromises[n]};const l=()=>e.refresh({_initial:!0}),d=a.server!==!1&&t.payload.serverRendered;{const i=w();if(i&&!i._nuxtOnBeforeMountCbs){i._nuxtOnBeforeMountCbs=[];const r=i._nuxtOnBeforeMountCbs;i&&(g(()=>{r.forEach(c=>{c()}),r.splice(0,r.length)}),D(()=>r.splice(0,r.length)))}d&&t.isHydrating&&o()?e.pending.value=!1:i&&(t.payload.serverRendered&&t.isHydrating||a.lazy)&&a.immediate?i._nuxtOnBeforeMountCbs.push(l):a.immediate&&l(),a.watch&&x(a.watch,()=>e.refresh());const f=t.hook("app:data:refresh",r=>{if(!r||r.includes(n))return e.refresh()});i&&D(f)}const m=Promise.resolve(t._asyncDataPromises[n]).then(()=>e);return Object.assign(m,e),m}function j(s,y){const n={};for(const u of y)n[u]=s[u];return n}const S=()=>{const s=C();return E()!=="v4"&&console.warn("useStrapi4 is only available for v4"),{find:(o,e)=>s(`/${o}`,{method:"GET",params:e}),findOne:(o,e,l)=>{typeof e=="object"&&(l=e,e=void 0);const d=[o,e].filter(Boolean).join("/");return s(d,{method:"GET",params:l})},create:(o,e)=>s(`/${o}`,{method:"POST",body:{data:e}}),update:(o,e,l)=>{typeof e=="object"&&(l=e,e=void 0);const d=[o,e].filter(Boolean).join("/");return s(d,{method:"PUT",body:{data:l}})},delete:(o,e)=>{const l=[o,e].filter(Boolean).join("/");return s(l,{method:"DELETE"})}}},M=()=>S();export{k as a,M as u};
